"use strict";
function getCookie(e) {
    return (e = document.cookie.match(new RegExp("(?:^|; )" + e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, "\\$1") + "=([^;]*)"))) ? decodeURIComponent(e[1]) : void 0
}
function setCookie(e, t, o) {
    var n, i = (o = o || {}).expires;
    "number" == typeof i && i && ((n = new Date).setTime(n.getTime() + 1e3 * i),
        i = o.expires = n),
    i && i.toUTCString && (o.expires = i.toUTCString());
    var r, c = e + "=" + (t = encodeURIComponent(t));
    for (r in o) {
        c += "; " + r;
        var d = o[r];
        !0 !== d && (c += "=" + d)
    }
    document.cookie = c,
        console.log("COOKIE")
}
document.addEventListener("DOMContentLoaded", init),
    window.addEventListener("load", loaded);
var _btn = document.querySelector(".main-btn")
    , _currStep = 1
    , _audio_music = document.querySelector("#snd-music")
    , _audio_reels = document.querySelector("#snd-reels")
    , _audio_reels_stop = document.querySelector("#snd-reels-stop")
    , _audio_popup_1 = document.querySelector("#snd-popup-1")
    , _audio_popup_2 = document.querySelector("#snd-popup-2")
    , _audio_win = document.querySelector("#snd-win");
function loaded() {
    getCookie("cosmo-cleo-wheel") ? (showPopup(2),
        document.querySelector(".main-cont").style.opacity = "1") : (document.querySelector(".intro").style.display = "block",
        document.querySelector(".intro").style.opacity = "1",
        document.querySelector(".intro-cont").classList.add("run"),
        setTimeout(hideIntro, 2500)),
        document.querySelector(".preload").style.display = "none",
        document.querySelector(".preloader").style.display = "none"
}
function hideIntro() {
    document.querySelector(".intro").classList.add("hide"),
        document.querySelector(".intro").addEventListener("animationend", function () {
            document.querySelector(".intro").style.display = "none"
        }),
        document.querySelector(".main-cont").style.opacity = "1",
        _btn.addEventListener("click", startWheelAnimation)
}
function init() {
    const e = document.getElementById("setCookie");
    getCookie("cosmo-cleo-wheel") && (document.location.href = e.href),
        window.onresize(null),
        document.querySelectorAll("#setCookieBtn").forEach(e => e.addEventListener("click", () => setCookie("cosmo-cleo-wheel", 1)))
}
var _contWidth = 980
    , _contHeight = 850
    , _contWidthMob = 980
    , _contHeightMob = 1800
    , _bgWidth = 1924
    , _bgHeight = 1219
    , _bgMobWidth = 1924
    , _bgMobHeight = 1219
    , _popupWidth = 592
    , _popupHeight = 318
    , _introWidth = 1220
    , _introHeight = 300
    , _introWidthMob = 1220
    , _introHeightMob = 300
    , _scale = 1;
function startWheelAnimation() {
    _btn.removeEventListener("click", startWheelAnimation),
        _btn.classList.add("disabled"),
        rotateWheel()
}
window.onresize = function () {
    window.innerWidth <= 640 ? (_scale = Math.min(window.innerWidth / _contWidthMob, window.innerHeight / _contHeightMob, 1),
        document.querySelector(".main-cont").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        _scale = Math.min(window.innerWidth / _introWidthMob, window.innerHeight / _introHeightMob, 1),
        document.querySelector(".intro-cont").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        _scale = Math.max(window.innerWidth / _bgMobWidth, window.innerHeight / _bgMobHeight),
        document.querySelector(".bg").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        document.querySelector(".video-bg").style.display = "none") : (_scale = Math.min(window.innerWidth / _contWidth, window.innerHeight / _contHeight, 1),
        document.querySelector(".main-cont").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        document.querySelector(".license").style.transform = "scale(" + _scale + ")",
        document.querySelector(".license").style.width = 100 / _scale + "%",
        _scale = Math.min(window.innerWidth / _introWidth, window.innerHeight / _introHeight, 1),
        document.querySelector(".intro-cont").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        _scale = Math.max(window.innerWidth / _bgWidth, window.innerHeight / _bgHeight),
        document.querySelector(".bg").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        document.querySelector(".video-bg").style.transform = "translate(-50%, -50%) scale(" + _scale + ")",
        document.querySelector(".video-bg").style.display = ""),
    document.querySelector(".popup-window") && (_scale = Math.min(window.innerWidth / _popupWidth, window.innerHeight / _popupHeight, 1),
        document.querySelector(".popup-window").style.transform = "translate(-50%, -50%) scale(" + _scale + ")")
}
;
var _wheel = document.querySelector(".wheel");
function rotateWheel() {
    _wheel.classList.remove("default"),
        _wheel.classList.remove("anim-1"),
        _wheel.classList.remove("anim-2"),
        _wheel.classList.add("anim-" + _currStep),
        _wheel.addEventListener("animationend", stopWheel),
        _audio_music.play(),
        _audio_reels.currentTime = 0,
        _audio_reels.play(),
        document.querySelector(".wheel-center").classList.add("run"),
    640 <= window.innerWidth && (document.querySelector("#video-bg-2").style.opacity = "1",
        document.querySelector("#video-bg-2").play())
}
function stopWheel() {
    _wheel.removeEventListener("animationend", stopWheel),
        _audio_reels.pause(),
        _audio_reels_stop.play();
    var e = 1500;
    2 === _currStep && (document.querySelector(".wheel-frame").classList.add("run"),
        e = 2500,
        _audio_music.pause(),
        _audio_win.play()),
    1 === _currStep && (640 <= window.innerWidth && (document.querySelector("#video-bg-2").style.opacity = "0",
        document.querySelector("#video-bg-2").pause()),
        document.querySelector(".wheel-center").classList.remove("run")),
        setTimeout(function (e) {
            showPopup(e)
        }, e, _currStep)
}
function showPopup(e) {
    document.querySelector(".popup").style.display = "block",
        document.querySelector(".popup-window").classList.add("popup-" + e),
    1 === e && (document.querySelector(".popup").classList.add("show"),
        document.querySelector("#turn-btn").addEventListener("click", hidePopup),
        _currStep++,
        _audio_popup_1.play()),
    2 === e && (document.querySelector(".popup").classList.add("show"),
        setCookie("cosmo-cleo-wheel", 1),
        _audio_popup_2.play(),
        setTimeout(function () {
            _audio_music.currentTime = 0,
                _audio_music.play()
        }, 2500))
}
function hidePopup() {
    document.querySelector("#turn-btn").removeEventListener("click", hidePopup),
        document.querySelector("#turn-btn").classList.add("disabled"),
        document.querySelector(".popup").classList.remove("show"),
        document.querySelector(".popup").classList.add("hide"),
        document.querySelector(".popup").addEventListener("animationend", delPopup),
        rotateWheel()
}
function delPopup() {
    console.log("del pop"),
        document.querySelector(".popup-window").classList.remove("popup-1"),
        document.querySelector(".popup").style.display = "none",
        document.querySelector(".popup").classList.remove("hide"),
        document.querySelector(".popup").removeEventListener("animationend", delPopup)
}
